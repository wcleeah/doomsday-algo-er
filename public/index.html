<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>What's the weekday?</title>
    <style>
      * {
        font-family: "JetBrains Mono", "Fira Code", ui-monospace, monospace;
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html, body {
        height: 100%;
        width: 100%;
      }

      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .form-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        padding: 20px;
      }

      .form-wrapper.at-top {
        flex: 0;
        justify-content: flex-start;
        padding-top: 40px;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
      }

      .input-container {
        display: flex;
        gap: 24px;
      }

      .hidden {
        display: none !important;
      }

      .answer-container {
        display: flex;
        flex: 1;
        width: 100%;
        min-height: 0;
      }

      .answer-ai {
        flex: 1;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        border-right: 1px solid #e0e0e0;
        background-color: #f8f9fa;
        padding: 40px;
        overflow-y: auto;
        white-space: pre-wrap;
      }

      .answer-algo {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
        padding: 40px;
        overflow-y: auto;
        white-space: pre-wrap;
        text-align: center;
      }

      .algo-result {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .algo-weekday {
        font-size: 48px;
        font-weight: bold;
        color: #333;
      }

      .algo-details {
        font-size: 14px;
        color: #666;
      }

      input {
        border: none;
        border-bottom: 1px solid #d0d0d0;
        background-color: transparent;
        border-radius: 0;
        padding: 8px 4px;
        font-size: 14px;
        color: #333;
        outline: none;
        transition: border-color 200ms ease;
        width: 80px;
        text-align: center;
      }

      input::placeholder {
        color: #bbb;
      }

      input:focus {
        border-bottom-color: #4a9eff;
      }

      input:hover:not(:focus) {
        border-bottom-color: #a0a0a0;
      }

      input:disabled {
        border-bottom-color: #e0e0e0;
        color: #999;
        cursor: not-allowed;
      }

      button {
        border: none;
        background-color: transparent;
        color: #333;
        padding: 10px 24px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 6px;
        cursor: pointer;
        outline: none;
        transition: all 200ms ease;
        margin-top: 8px;
      }

      button:hover {
        border: 1px solid #333;
        background-color: #333;
        color: #fff;
      }

      button:active {
        transform: scale(0.98);
      }

      button:disabled {
        color: #ccc;
        cursor: not-allowed;
        background-color: transparent;
      }

      #reset-button {
        margin-top: 0;
      }

      .animating {
        will-change: transform;
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 24px;
        }

        .container {
          align-items: stretch;
        }

        h1 {
          text-align: center;
        }

        .input-container {
          flex-direction: column;
          gap: 12px;
        }

        input {
          width: 100%;
        }

        .answer-container {
          flex-direction: column;
        }

        .answer-ai {
          border-right: none;
          border-bottom: 1px solid #e0e0e0;
          padding: 20px;
        }

        .answer-algo {
          padding: 20px;
        }

        .form-wrapper.at-top {
          padding-top: 20px;
        }

        .algo-weekday {
          font-size: 36px;
        }
      }
    </style>
  </head>
  <body>
    <div class="form-wrapper" id="formWrapper">
      <div class="container">
        <h1>Find the weekday...</h1>
        <div class="input-container">
          <input id="year" type="text" placeholder="year" />
          <input id="month" type="text" placeholder="month" />
          <input id="day" type="text" placeholder="day" />
        </div>
        <button id="submit-button">Submit</button>
        <button id="reset-button" class="hidden">Reset</button>
      </div>
    </div>
    <div class="answer-container hidden" id="answerContainer">
      <div class="answer-ai">Loading...</div>
      <div class="answer-algo">Loading...</div>
    </div>
  </body>
  <script>
    function flipAnimation(element, finalClass) {
      // First: Get the initial position
      const first = element.getBoundingClientRect();

      // Apply the final state class
      element.classList.add(finalClass);

      // Last: Get the final position
      const last = element.getBoundingClientRect();

      // Invert: Calculate the difference
      const deltaY = first.top - last.top;
      const deltaX = first.left - last.left;

      // Apply transform to put element back where it was visually
      element.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
      element.classList.add('animating');

      // Force a reflow
      element.offsetHeight;

      // Play: Animate to final position
      element.style.transition = 'transform 300ms ease-in-out';
      element.style.transform = '';

      // Cleanup after animation
      element.addEventListener('transitionend', () => {
        element.style.transition = '';
        element.classList.remove('animating');
      }, { once: true });
    }

    document.getElementById('submit-button').addEventListener('click', async () => {
      const formWrapper = document.getElementById('formWrapper');
      const answerContainer = document.getElementById('answerContainer');
      const button = document.getElementById('submit-button');
      const answerAi = document.querySelector('.answer-ai');
      const answerAlgo = document.querySelector('.answer-algo');

      answerContainer.classList.remove('hidden');
      flipAnimation(formWrapper, 'at-top');
      button.classList.add('hidden');

      document.querySelectorAll('input').forEach((input) => {
        input.disabled = true;
      });

      const year = document.getElementById('year').value;
      const month = document.getElementById('month').value;
      const day = document.getElementById('day').value;
      const query = `?year=${year}&month=${month}&day=${day}`;

      document.getElementById('reset-button').classList.remove('hidden');

      fetch(`/openrouter${query}`)
        .then(async (res) => {
          if (!res.ok) throw new Error('OpenRouter request failed');
          const reader = res.body?.getReader();
          if (!reader) throw new Error('No stream available');
          const decoder = new TextDecoder();
          answerAi.textContent = '';
          while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            const text = decoder.decode(value);
            const lines = text.split('\n');
            for (const line of lines) {
              if (line.startsWith('data: ')) {
                const data = line.slice(6);
                if (data === '[DONE]') continue;
                try {
                  const json = JSON.parse(data);
                  const content = json.choices?.[0]?.delta?.content;
                  if (content) answerAi.textContent += content;
                } catch {}
              }
            }
          }
        })
        .catch((err) => {
          answerAi.textContent = `Error: ${err.message}`;
        });

      fetch(`/dooooooooooooooooooooooooooooom${query}`)
        .then(async (res) => {
          if (!res.ok) throw new Error('Doomsday request failed');
          const data = await res.json();
          const { weekday, doomsdayWeekday } = data.data;
          const weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
          answerAlgo.innerHTML = `
            <div class="algo-result">
              <div class="algo-weekday">${weekdays[weekday]}</div>
              <div class="algo-details">Doomsday: ${weekdays[doomsdayWeekday]}</div>
            </div>
          `;
        })
        .catch((err) => {
          answerAlgo.textContent = `Error: ${err.message}`;
        });
    });

    document.getElementById('reset-button').addEventListener('click', () => {
      document.querySelectorAll('input').forEach((input) => {
        input.disabled = false;
        input.value = '';
      });
      document.getElementById('submit-button').classList.remove('hidden');
      document.getElementById('reset-button').classList.add('hidden');
      document.getElementById('answerContainer').classList.add('hidden');
      document.getElementById('formWrapper').classList.remove('at-top');
    });
  </script>
</html>
