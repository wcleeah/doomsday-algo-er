<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>What's the weekday?</title>
    <style>
      :root {
        --font-mono: "JetBrains Mono", "Fira Code", ui-monospace, monospace;
        --color-primary: #333;
        --color-accent: #4a9eff;
        --color-border: #d0d0d0;
        --color-border-hover: #a0a0a0;
        --color-border-focus: #4a9eff;
        --color-bg: #f8f9fa;
        --color-text: #333;
        --color-text-muted: #666;
        --color-text-light: #999;
        --color-placeholder: #bbb;
        --color-disabled: #ccc;
        --transition-ease: 200ms ease;
        --transition-animation: 300ms ease-in-out;
        --spacing-gap: 16px;
        --spacing-gap-mobile: 12px;
      }

      * {
        font-family: var(--font-mono);
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html, body {
        height: 100%;
        width: 100%;
      }

      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      .form-wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        flex: 1;
        padding: 20px;
      }

      .form-wrapper.at-top {
        flex: 0;
        justify-content: flex-start;
        padding-top: 40px;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--spacing-gap);
      }

      .input-container {
        display: flex;
        gap: 24px;
      }

      .hidden {
        display: none !important;
      }

      .answer-container {
        display: flex;
        flex: 1;
        width: 100%;
        min-height: 0;
      }

      .answer-ai {
        flex: 1;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        border-right: 1px solid #e0e0e0;
        background-color: var(--color-bg);
        padding: 40px;
        overflow-y: auto;
        white-space: pre-wrap;
      }

      .answer-algo {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--color-bg);
        padding: 40px;
        overflow-y: auto;
        white-space: pre-wrap;
        text-align: center;
      }

      .algo-result {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .algo-weekday {
        font-size: 48px;
        font-weight: bold;
        color: var(--color-text);
      }

      .algo-details {
        font-size: 14px;
        color: var(--color-text-muted);
      }

      input {
        border: none;
        border-bottom: 1px solid var(--color-border);
        background-color: transparent;
        border-radius: 0;
        padding: 8px 4px;
        font-size: 14px;
        color: var(--color-text);
        outline: none;
        transition: border-color var(--transition-ease);
        width: 80px;
        text-align: center;
      }

      input::placeholder {
        color: var(--color-placeholder);
      }

      input:focus {
        border-bottom-color: var(--color-border-focus);
      }

      input:hover:not(:focus) {
        border-bottom-color: var(--color-border-hover);
      }

      input:disabled {
        border-bottom-color: #e0e0e0;
        color: var(--color-text-light);
        cursor: not-allowed;
      }

      button {
        border: none;
        background-color: transparent;
        color: var(--color-text);
        padding: 10px 24px;
        font-size: 14px;
        font-weight: 500;
        border-radius: 6px;
        cursor: pointer;
        outline: none;
        transition: all var(--transition-ease);
        margin-top: 8px;
      }

      button:hover {
        border: 1px solid var(--color-text);
        background-color: var(--color-text);
        color: #fff;
      }

      button:active {
        transform: scale(0.98);
      }

      button:disabled {
        color: var(--color-disabled);
        cursor: not-allowed;
        background-color: transparent;
      }

      #reset-button {
        margin-top: 0;
      }

      .animating {
        will-change: transform;
      }

      h1 {
        text-align: center;
      }

      @media (max-width: 600px) {
        h1 {
          font-size: 24px;
        }

        .container {
          align-items: stretch;
        }

        .input-container {
          flex-direction: column;
          gap: var(--spacing-gap-mobile);
        }

        input {
          width: 100%;
        }

        .answer-container {
          flex-direction: column;
        }

        .answer-ai {
          border-right: none;
          border-bottom: 1px solid #e0e0e0;
          padding: 20px;
        }

        .answer-algo {
          padding: 20px;
        }

        .form-wrapper.at-top {
          padding-top: 20px;
        }

        .algo-weekday {
          font-size: 36px;
        }
      }
    </style>
  </head>
  <body>
    <div class="form-wrapper" id="formWrapper">
      <div class="container">
        <h1>Find the weekday...</h1>
        <div class="input-container">
          <input id="year" type="text" placeholder="year" />
          <input id="month" type="text" placeholder="month" />
          <input id="day" type="text" placeholder="day" />
        </div>
        <button id="submit-button">Submit</button>
        <button id="reset-button" class="hidden">Reset</button>
      </div>
    </div>
    <div class="answer-container hidden" id="answerContainer">
      <div class="answer-ai">Loading...</div>
      <div class="answer-algo">Loading...</div>
    </div>
  </body>
  <script>
    const WEEKDAYS = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

    const DOM = {
      formWrapper: null,
      answerContainer: null,
      submitButton: null,
      resetButton: null,
      answerAi: null,
      answerAlgo: null,
      inputs: null,
      init() {
        this.formWrapper = document.getElementById('formWrapper');
        this.answerContainer = document.getElementById('answerContainer');
        this.submitButton = document.getElementById('submit-button');
        this.resetButton = document.getElementById('reset-button');
        this.answerAi = document.querySelector('.answer-ai');
        this.answerAlgo = document.querySelector('.answer-algo');
        this.inputs = document.querySelectorAll('input');
      }
    };

    function flipAnimation(element, finalClass) {
      const first = element.getBoundingClientRect();
      element.classList.add(finalClass);
      const last = element.getBoundingClientRect();
      const deltaY = first.top - last.top;
      const deltaX = first.left - last.left;

      element.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
      element.classList.add('animating');
      element.offsetHeight;

      element.style.transition = 'transform var(--transition-animation)';
      element.style.transform = '';

      element.addEventListener('transitionend', () => {
        element.style.transition = '';
        element.classList.remove('animating');
      }, { once: true });
    }

    function validateInput(value, name) {
      const num = parseInt(value, 10);
      if (Number.isNaN(num) || num < 1) {
        throw new Error(`Invalid ${name}: must be a positive number`);
      }
      return num;
    }

    function setInputsDisabled(disabled) {
      DOM.inputs.forEach((input) => {
        input.disabled = disabled;
      });
    }

    function toggleButtons(submitVisible, resetVisible) {
      DOM.submitButton.classList.toggle('hidden', !submitVisible);
      DOM.resetButton.classList.toggle('hidden', !resetVisible);
    }

    async function fetchAiResponse(query) {
      const response = await fetch(`/openrouter${query}`);
      if (!response.ok) throw new Error('OpenRouter request failed');

      const reader = response.body?.getReader();
      if (!reader) throw new Error('No stream available');

      const decoder = new TextDecoder();
      DOM.answerAi.textContent = '';

      while (true) {
        const { done, value } = await reader.read();
        if (done) break;
        const text = decoder.decode(value);
        const lines = text.split('\n');

        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const data = line.slice(6);
            if (data === '[DONE]') continue;
            try {
              const json = JSON.parse(data);
              const content = json.choices?.[0]?.delta?.content;
              if (content) DOM.answerAi.textContent += content;
            } catch {}
          }
        }
      }
    }

    async function fetchAlgoResponse(query) {
      const response = await fetch(`/dooooooooooooooooooooooooooooom${query}`);
      if (!response.ok) throw new Error('Doomsday request failed');

      const data = await response.json();
      const { weekday, doomsdayWeekday } = data.data;

      DOM.answerAlgo.innerHTML = `
        <div class="algo-result">
          <div class="algo-weekday">${WEEKDAYS[weekday]}</div>
          <div class="algo-details">Doomsday: ${WEEKDAYS[doomsdayWeekday]}</div>
        </div>
      `;
    }

    async function handleSubmit() {
      DOM.answerContainer.classList.remove('hidden');
      flipAnimation(DOM.formWrapper, 'at-top');
      toggleButtons(false, true);
      setInputsDisabled(true);

      const year = DOM.inputs[0].value;
      const month = DOM.inputs[1].value;
      const day = DOM.inputs[2].value;

      validateInput(year, 'year');
      validateInput(month, 'month');
      validateInput(day, 'day');

      const query = `?year=${year}&month=${month}&day=${day}`;

      Promise.allSettled([
        fetchAiResponse(query),
        fetchAlgoResponse(query)
      ]).then(([aiResult, algoResult]) => {
        if (aiResult.status === 'rejected') {
          DOM.answerAi.textContent = `Error: ${aiResult.reason.message}`;
        }
        if (algoResult.status === 'rejected') {
          DOM.answerAlgo.textContent = `Error: ${algoResult.reason.message}`;
        }
      });
    }

    function handleReset() {
      setInputsDisabled(false);
      DOM.inputs.forEach((input) => {
        input.value = '';
      });
      toggleButtons(true, false);
      DOM.answerContainer.classList.add('hidden');
      DOM.formWrapper.classList.remove('at-top');
    }

    DOM.init();

    DOM.submitButton.addEventListener('click', handleSubmit);
    DOM.resetButton.addEventListener('click', handleReset);

    DOM.inputs.forEach((input) => {
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSubmit();
      });
    });
  </script>
</html>
